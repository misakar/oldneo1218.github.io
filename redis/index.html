<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    
    
    <!-- google site -->
    <meta name="google-site-verification" content="BazmSJ55LY7H3RD6ttelAsE8PmOPjhkFnDdIjFMCiJE" />
    <title>neo1218の死宅 - POST</title>
    <link rel="shortcut icon" href="http://7xj431.com1.z0.glb.clouddn.com/cropped-150-150-688417.png" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href=/static/css/base_site.css>
    <link rel="stylesheet" type="text/css" href=/static/css/index.css>
    <link rel="stylesheet" type="text/css" href=/static/css/post.css>
    <link rel="stylesheet" type="text/css" href=/static/css/self_card.css>
    <link rel="stylesheet" type="text/css" href=/static/css/logo/github.css>
    <link rel="stylesheet" type="text/css" href=/static/css/logo/facebook.css>
    <link rel="stylesheet" type="text/css" href=/static/css/logo/twitter.css>
    <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/pygments.css">
    <link href=/static/image/bg.png>
</head>
<body>
<header>
    <div class="top-z-container">
        <!--blur-->
        <div class="blur-top-image"></div>
        <div id="top-bar">
            <nav class="left-box">
                <ul>
                    <li>
                        <a href=/>neo1218の死宅</a> - Pythoner 死宅到底 不想说话 木犀万岁!
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <div id="top-image"></div>
    <nav class="nav-wrapper">
        <ul class="category-list">
            <li>
                <a href=/>
                    <span>首页</span>
                    <div class="menu-icon-wrapper">
                        <span class="menu-icon icon-no-bg-color fa fa-home"></span>
                    </div>
                </a>
            </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Web/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">7</span>
                        </div>
                        Web
                    </a>
                    <ul class="drop-down" align="center">
                        <span>Web开发</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Life/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">2</span>
                        </div>
                        Life
                    </a>
                    <ul class="drop-down" align="center">
                        <span>生活随笔</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Python/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">15</span>
                        </div>
                        Python
                    </a>
                    <ul class="drop-down" align="center">
                        <span>Python学习</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Other/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">3</span>
                        </div>
                        Other
                    </a>
                    <ul class="drop-down" align="center">
                        <span>其他</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/DIY/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">4</span>
                        </div>
                        DIY
                    </a>
                    <ul class="drop-down" align="center">
                        <span>个人项目</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/OS/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">5</span>
                        </div>
                        OS
                    </a>
                    <ul class="drop-down" align="center">
                        <span>操作系统学习</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Algo/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">7</span>
                        </div>
                        Algo
                    </a>
                    <ul class="drop-down" align="center">
                        <span>算法学习</span>
                    </ul>
                </li>
            
            <li>
                <a href=/about/>
                    <span>关于</span>
                    <div class="menu-icon-wrapper">
                        <span class="menu-icon icon-no-bg-color fa fa-info"></span>
                    </div>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main>
    <div id="main">
        
<div class="post-body-wrapper">
    <div class="main_post">
        <h1>python中使用redis数据库</h1>
        <h3>2016-06-19 10:30:51</h3>
        <div class="post_body">
            <h2 id="redis">redis 简介</h2>

<p><a href="https://github.com/antirez/redis">re(mote)di(ctionary)s(erver)</a>是NoSql数据库中的<a href="http://baike.baidu.com/subview/359944/11208033.htm">一朵奇葩(古意)</a>, 他具有以下主要特点:</p>

<ol>
<li>以<strong>字典结构存储数据</strong></li>
<li>允许通过<strong>TCP协议</strong>读取字典的内容</li>
<li>强大的缓存系统, 可以为<strong>每个键设置TTL</strong>, 以及按照一定规则<strong>自动淘汰不需要的键</strong></li>
<li>支持使用<strong>列表</strong>的形式构造<strong>任务队列</strong></li>
<li><strong>数据存储在内存</strong>中也可以<strong>持久化到硬盘</strong></li>
</ol>

<p>看到以上特点, 第一感觉就是redis很灵活, 很强大, 既可内存快速存取,<br />
又可持久化到硬盘; 其次, 我想很多pythoner都会会心一笑, 是的redis和python可以说是有天然的联系,<br />
都具有列表, 字典等数据结构, 如果接口设计的好,那么在python中使用redis可以说是特别舒服的。<br />
基于TCP协议,可以让我们实现远程连接,<br />
本地python代码无缝操作redis。是不是很激动!!!! 我下面就会介绍这样一个强大的工具<strong>redis-py</strong>, 当然我还是先详细说一下redis。</p>

<h2 id="redis_1">安装redis</h2>

<h3 id="linux">linux:</h3>

<ol>
<li><code>wget http://download.redis.io/releases/redis-2.6.16.tar.gz</code></li>
<li><code>tar -xzvf redis-2.6.16.tar.gz</code></li>
<li><code>cd redis-2.6.16</code></li>
<li><code>make &amp;&amp; make install</code></li>
</ol>

<h3 id="mac-os">mac os:</h3>

<p>强大的homebrew!</p>

<pre><code>brew install redis
</code></pre>

<p>redis安装在<code>/usr/local/bin/</code>目录</p>

<pre><code>redis-benchmark: ==&gt; 性能测试工具
redis-check-aof: ==&gt; AOF文件修复工具
redis-check-dump: =&gt; RDB文件检查工具
redis-cli:       ==&gt; 命令行客户端
redis-sentinel:   =&gt; 帮助管理redis实例的工具
redis-server:    ==&gt; redis服务器
</code></pre>

<h2 id="redis_2">启动redis</h2>

<h3 id="_1">直接启动:</h3>

<ol>
<li><code>redis-server</code> 默认端口<a href="http://blog.nosqlfan.com/html/790.html">6379</a></li>
<li><code>redis-server &ndash;port 端口号</code></li>
<li><code>redis-server /abspath/to/config.conf &ndash;loglevel<br />
   warning</code>启动时的配置文件将覆盖系统同名配置项</li>
</ol>

<p><img alt="redis run" src="http://7xj431.com1.z0.glb.clouddn.com/redis" /></p>

<h3 id="redis_3">redis命令行客户端连接:</h3>

<pre><code>redis-cli -h IP -p 端口
</code></pre>

<h2 id="5">5种数据类型</h2>

<h3 id="0">0. 基础命令</h3>

<p>从命令行客户端连接上redis后, 会出现类似python的REPL接口,<br />
我们可以在此对redis的数据进行操作。</p>

<h4 id="_2">返回符合规则(通配符)的键值列表</h4>

<pre><code>&gt; KEYS pattern
</code></pre>

<h4 id="exkey-1-0">判断键(ex:key)是否存在, 存在返回1, 不存在返回0</h4>

<pre><code>&gt; EXISTS key
</code></pre>

<h4 id="exkey">删除键(ex:key)</h4>

<p>可以同时删除多个键, 返回成功删除键的个数</p>

<pre><code>&gt; DEL key
</code></pre>

<h4 id="_3">获取值的数据类型</h4>

<pre><code>&gt; SET key 1
OK
&gt; TYPE key
string
</code></pre>

<p>再说一次, 有么有和python很像!!!</p>

<h3 id="1">1. 字符串类型</h3>

<h3 id="2">2. 散列类型</h3>

<h3 id="3">3. 列表类型</h3>

<h3 id="4">4. 集合类型</h3>

<h3 id="5_1">5. 有序集合</h3>

<h2 id="redis-py">redis-py</h2>

<p>redis-py是一个强大的工具, 可以使用它从而在python代码中实现类似redis的语法,<br />
它提供了两个类: <em>StrictRedis</em>和<em>Redis</em>, Redis类是StrictRedis的子类,<br />
用于兼容旧的redis语法。</p>

<h3 id="redis-py_1">安装 redis-py</h3>

<pre><code>$ pip install redis
</code></pre>

<h3 id="redis-py_2">使用 redis-py</h3>

<p>直接使用:</p>

<pre><code>&gt;&gt;&gt; import redis
&gt;&gt;&gt; r = redis.StrictRedis(host="hostname", port=port, db=0)
&gt;&gt;&gt; r.set('key', 'value')
True
&gt;&gt;&gt; r.get('key')
'value'
</code></pre>

<p>创建连接池:</p>

<pre><code># 创建连接池的好处在于这样就不用每创建(销毁)一个redis实例就进行一次数据库的连接(释放),
# 一个redis连接池可以管理多个redis实例(线程)
import redis

pool = redis.ConnectionPool(host='hostname', port=port)
r = redis.Redis(connection_pool = pool)
# 然后就可以使用r对象啦!
</code></pre>

<p>pipeline机制:</p>

<h2 id="_4">总结:</h2>

<p>这篇博客是我从一个<strong>学习者</strong>角度写作的, 接下来我会继续我的redis学习,<br />
但是会逐渐把目光放到<strong>生产环境</strong>,<br />
即作为一个<strong>使用者</strong>。redis在生产环境中的使用就不得不说<strong>配置文件</strong>,<br />
这也是一个头大的问题&hellip;后面还会总结一下相关的redis应用实例[期待]。<br />
<hr/></p>

<blockquote>
<p>其实一开始我是拒绝redis的</p>
</blockquote>

<p>一开始我是因为flask, 准备使用redis, 但是直接从使用出发, 你懂得,<br />
什么celery任务队列, 看不明白。现在才知道, 这么大块知识那时没有了解&hellip;<br />
而且这次写CCNU爬虫, 在flask里面就很好地使用了redis(ps: 纯python写, 视图封装&hellip;), 感受到了redis的强大。</p>

        </div>
    </div>
    <div id="disqus_thread" style="padding: 50px"></div>
    <script>
    /**
    * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    
    s.src = '//neo1218flask.disqus.com/embed.js';
    
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

    </div>
</main>
<footer>
    <div id="foot">
        
            <div class="footer">
                <span>
                    Powered by:
                    <a href="https://github.com/neo1218/railgun/" target="_blank">railgun</a>
                    I am a loser
                </span>
                <br>
            </div>
        
    </div>
</footer>
<a href="#" id="toTop" style="top: 0px;" onclick="scroll_to_top(0.9); return false;">
    <div id="toTopRope"></div>
    <img id="toTopHover" src="http://7xj431.com1.z0.glb.clouddn.com/topscroll.png"></div>
</a>
</body>
    <script src=/static/js/base_site.js> </script>
    <script src=/static/js/disqus/embed.js></script>
</html>