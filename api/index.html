<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    
    
    <!-- google site -->
    <meta name="google-site-verification" content="BazmSJ55LY7H3RD6ttelAsE8PmOPjhkFnDdIjFMCiJE" />
    <title>neo1218の死宅 - POST</title>
    <link rel="shortcut icon" href="http://7xj431.com1.z0.glb.clouddn.com/cropped-150-150-688417.png" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href=/static/css/base_site.css>
    <link rel="stylesheet" type="text/css" href=/static/css/index.css>
    <link rel="stylesheet" type="text/css" href=/static/css/post.css>
    <link rel="stylesheet" type="text/css" href=/static/css/self_card.css>
    <link rel="stylesheet" type="text/css" href=/static/css/logo/github.css>
    <link rel="stylesheet" type="text/css" href=/static/css/logo/facebook.css>
    <link rel="stylesheet" type="text/css" href=/static/css/logo/twitter.css>
    <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/pygments.css">
    <link href=/static/image/bg.png>
</head>
<body>
<header>
    <div class="top-z-container">
        <!--blur-->
        <div class="blur-top-image"></div>
        <div id="top-bar">
            <nav class="left-box">
                <ul>
                    <li>
                        <a href=/>neo1218の死宅</a> - Pythoner 死宅到底 不想说话 木犀万岁!
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <div id="top-image"></div>
    <nav class="nav-wrapper">
        <ul class="category-list">
            <li>
                <a href=/>
                    <span>首页</span>
                    <div class="menu-icon-wrapper">
                        <span class="menu-icon icon-no-bg-color fa fa-home"></span>
                    </div>
                </a>
            </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Web/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">7</span>
                        </div>
                        Web
                    </a>
                    <ul class="drop-down" align="center">
                        <span>Web开发</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Life/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">2</span>
                        </div>
                        Life
                    </a>
                    <ul class="drop-down" align="center">
                        <span>生活随笔</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Python/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">15</span>
                        </div>
                        Python
                    </a>
                    <ul class="drop-down" align="center">
                        <span>Python学习</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Other/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">3</span>
                        </div>
                        Other
                    </a>
                    <ul class="drop-down" align="center">
                        <span>其他</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/DIY/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">4</span>
                        </div>
                        DIY
                    </a>
                    <ul class="drop-down" align="center">
                        <span>个人项目</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/OS/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">5</span>
                        </div>
                        OS
                    </a>
                    <ul class="drop-down" align="center">
                        <span>操作系统学习</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Algo/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">7</span>
                        </div>
                        Algo
                    </a>
                    <ul class="drop-down" align="center">
                        <span>算法学习</span>
                    </ul>
                </li>
            
            <li>
                <a href=/about/>
                    <span>关于</span>
                    <div class="menu-icon-wrapper">
                        <span class="menu-icon icon-no-bg-color fa fa-info"></span>
                    </div>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main>
    <div id="main">
        
<div class="post-body-wrapper">
    <div class="main_post">
        <h1>Flask编写API的核心思想</h1>
        <h3>2016-06-19 10:03:46</h3>
        <div class="post_body">
            <blockquote>
<p>这篇文章，是我的自言自语</p>
</blockquote>

<h2 id="q-api">Q: 为什么需要API</h2>

<p><strong>A</strong>: 当客户端与服务器端分离时, 需要通过API传递资源</p>

<h2 id="q">Q: 什么是资源</h2>

<p><strong>A</strong>: 即数据库中的数据</p>

<h2 id="q_1">Q: 如何表示资源</h2>

<p><strong>A</strong>: 使用json的方式表示, 以<strong>键值的方式</strong>表示一个资源, 每一个键代表资源的一个属性; 使用数组(列表)表示资源的集合, 例如</p>

<pre><code>[
    {
        'id': 1,
        'username': 'neo1218'
    },
    {
        'id': 2,
        'username': 'zxc0328'
    }
]
</code></pre>

<h2 id="q-http">Q: 如何使用HTTP的方式对资源进行操作</h2>

<p><strong>A</strong>: 涉及HTTP方法映射: 如下表</p>

<pre><code>GET ------&gt; 获取(集合,特定资源)
POST -----&gt; 创建(特定资源)
PUT ------&gt; 更新(特定资源)
DELETE ---&gt; 删除(特定资源)
</code></pre>

<h2 id="q-flaskapi">Q: 那么flask编写API的核心是什么?</h2>

<p><strong>A</strong>: <br/></p>

<h3 id="1">1. 提供资源</h3>

<p>flask需要把数据库资源通过json的形式提供出去, 所以需要在数据库Model中定义<code>to_json方法</code>, 以<br />
json的形式表示数据库数据, 以User类为例</p>

<pre><code>class User(db.Model):
    ......
    def to_json(self):
        json_user = {
            'id': self.id,
            'username': self.username
        }
        return json_user
    ......
</code></pre>

<h3 id="2-json">2. 接受json数据</h3>

<p>flask需要接受客户端发送的json数据从而用于创建资源,<br />
所以需要在数据库Model中定义<code>from_json方法</code></p>

<pre><code>class User(db.Model):
    ......
    @staticmethod
    def from_json(json_data):
        user = User(
            username = json_data.get('username'),
            password = json_data.get('password')
        )
        return user
    ......
</code></pre>

<p>并在API代码中搭配<a href=""><code>request.get_json()</code></a>使用</p>

<pre><code>/api/users.py

from flask import request

@api.route('/users/', methods=['POST'])
def create_user():
    user = User.from_json(request.get_json())
    db.session.add(user)
    db.session.commit()
</code></pre>

<h3 id="http">HTTP方法与操作对应</h3>

<p>还是以用户资源为例:</p>

<pre><code>@api.route('/users/', methods=['GET'])
def get_users():
    """获取用户资源集合"""
    pass

@api.route('/users/&lt;int:id&gt;/', methods=['GET'])
def get_id_users(id):
    """获取特定id用户资源"""
    pass

@api.route('/users/', methods=['GET', 'POST'])
def create_user():
    """创建用户资源"""
    pass

@api.route('/users/&lt;int:id&gt;/', methods=['GET', 'PUT'])
def update_id_user(id):
    """更新特定id用户资源"""
    pass

@api.route('/users/&lt;int:id&gt;/', methods=['GET', 'DELETE'])
def delete_id_user(id):
    """删除特定id用户"""
    pass
</code></pre>

<h2 id="q-flaskapijsonhttp">Q: 所以说flask编写API的核心思想就是<strong>以json的方式表示和接收资源并将相应操作映射到http方法上从而操纵资源</strong>, 是吗?</h2>

<p><strong>A</strong>: 你这不是废话吗....</p>

        </div>
    </div>
    <div id="disqus_thread" style="padding: 50px"></div>
    <script>
    /**
    * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    
    s.src = '//neo1218flask.disqus.com/embed.js';
    
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

    </div>
</main>
<footer>
    <div id="foot">
        
            <div class="footer">
                <span>
                    Powered by:
                    <a href="https://github.com/neo1218/railgun/" target="_blank">railgun</a>
                    I am a loser
                </span>
                <br>
            </div>
        
    </div>
</footer>
<a href="#" id="toTop" style="top: 0px;" onclick="scroll_to_top(0.9); return false;">
    <div id="toTopRope"></div>
    <img id="toTopHover" src="http://7xj431.com1.z0.glb.clouddn.com/topscroll.png"></div>
</a>
</body>
    <script src=/static/js/base_site.js> </script>
    <script src=/static/js/disqus/embed.js></script>
</html>