<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    
    
    <!-- google site -->
    <meta name="google-site-verification" content="BazmSJ55LY7H3RD6ttelAsE8PmOPjhkFnDdIjFMCiJE" />
    <title>neo1218ã®æ­»å®… - POST</title>
    <link rel="shortcut icon" href="http://7xj431.com1.z0.glb.clouddn.com/cropped-150-150-688417.png" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href=/static/css/base_site.css>
    <link rel="stylesheet" type="text/css" href=/static/css/index.css>
    <link rel="stylesheet" type="text/css" href=/static/css/post.css>
    <link rel="stylesheet" type="text/css" href=/static/css/self_card.css>
    <link rel="stylesheet" type="text/css" href=/static/css/github.css>
    <link rel="stylesheet" type="text/css" href=/static/css/logo/github.css>
    <link rel="stylesheet" type="text/css" href=/static/css/logo/facebook.css>
    <link rel="stylesheet" type="text/css" href=/static/css/logo/twitter.css>
    <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link href=/static/image/bg.png>
</head>
<body>
<header>
    <div class="top-z-container">
        <!--blur-->
        <div class="blur-top-image"></div>
        <div id="top-bar">
            <nav class="left-box">
                <ul>
                    <li>
                        <a href=/>neo1218ã®æ­»å®…</a> - Pythoner æ­»å®…åˆ°åº• ä¸æƒ³è¯´è¯ æœ¨çŠ€ä¸‡å²!
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <div id="top-image"></div>
    <nav class="nav-wrapper">
        <ul class="category-list">
            <li>
                <a href=/>
                    <span>é¦–é¡µ</span>
                    <div class="menu-icon-wrapper">
                        <span class="menu-icon icon-no-bg-color fa fa-home"></span>
                    </div>
                </a>
            </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Web/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">7</span>
                        </div>
                        Web
                    </a>
                    <ul class="drop-down" align="center">
                        <span>Webå¼€å‘</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Life/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">3</span>
                        </div>
                        Life
                    </a>
                    <ul class="drop-down" align="center">
                        <span>ç”Ÿæ´»éšç¬”</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Read/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">1</span>
                        </div>
                        Read
                    </a>
                    <ul class="drop-down" align="center">
                        <span>è¯»ä¹¦</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Python/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">16</span>
                        </div>
                        Python
                    </a>
                    <ul class="drop-down" align="center">
                        <span>Pythonå­¦ä¹ </span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Other/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">3</span>
                        </div>
                        Other
                    </a>
                    <ul class="drop-down" align="center">
                        <span>å…¶ä»–</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/DIY/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">4</span>
                        </div>
                        DIY
                    </a>
                    <ul class="drop-down" align="center">
                        <span>ä¸ªäººé¡¹ç›®</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/C%26Cpp/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">1</span>
                        </div>
                        C&amp;Cpp
                    </a>
                    <ul class="drop-down" align="center">
                        <span>None</span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/OS/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">5</span>
                        </div>
                        OS
                    </a>
                    <ul class="drop-down" align="center">
                        <span>æ“ä½œç³»ç»Ÿå­¦ä¹ </span>
                    </ul>
                </li>
            
                <li onmouseover="show_menu(this)" onmouseout="hide_menu(this)">
                    <a href=/tag/Algo/>
                        <div class="menu-icon-wrapper">
                            <span class="menu-icon">7</span>
                        </div>
                        Algo
                    </a>
                    <ul class="drop-down" align="center">
                        <span>ç®—æ³•å­¦ä¹ </span>
                    </ul>
                </li>
            
            <li>
                <a href=/about/>
                    <span>å…³äº</span>
                    <div class="menu-icon-wrapper">
                        <span class="menu-icon icon-no-bg-color fa fa-info"></span>
                    </div>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main>
    <div id="main">
        
<div class="post-body-wrapper">
    <div class="main_post">
        <h1>Why Reload?</h1>
        <h3>2016-12-01 10:31:53</h3>
        <div class="post_body">
            <h2 id="_1">è®¾å®šç¼–ç çš„æƒ¯ä¾‹</h2>

<p>å½“è®¾å®špythonæ–‡ä»¶ç¼–ç æ—¶</p>

<pre><code>import sys

reload(sys)
sys.setdefaultencoding('utf-8')
</code></pre>

<p>ä¸‰è¡Œæå®šï¼Œå¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæ±‰å­—ä¹±ç äº†ï¼ğŸ˜„</p>

<h2 id="_2">ç„¶è€Œï¼šé—®é¢˜æ¥äº†</h2>

<p>å‡ ä¸ªæœˆåçš„ä¸€å¤©ï¼Œæˆ‘çš„ä¸€ä¸ªæœ‹å‹é—®æˆ‘ï¼šä¸ºä»€ä¹ˆè¦ reload(sys) ? ğŸ˜”</p>

<h2 id="so-why-reloadsys">SO: Why reload(sys)</h2>

<h3 id="1-sys">1. sys</h3>

<pre><code>sys æ˜¯ä¸€ä¸ªpythonæ¨¡å—ï¼ŒåŒ…å«ç³»ç»Ÿå¯¹åº”çš„åŠŸèƒ½ï¼Œæ¯”å¦‚é€šè¿‡argvè·å–è¿è¡Œæ—¶å‘½ä»¤è¡Œå‚æ•°
</code></pre>

<p>å…·ä½“è§http://www.cnblogs.com/diege/archive/2012/10/03/2710776.html <br/></p>

<h3 id="2-setdefaultencoding">2. setdefaultencoding å‡½æ•°</h3>

<p>setdefaultencoding æ˜¯sysæ¨¡å—æä¾›çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥<strong>ä¿®æ”¹é»˜è®¤ç¼–ç </strong><br/></p>

<h3 id="3-python">3. python åŠ è½½æ¨¡å—çš„è¿‡ç¨‹</h3>

<pre><code>è¿è¡Œè§£é‡Šå™¨ -&gt; åŠ è½½åº“æ–‡ä»¶(ex: site.py) -&gt; åŠ è½½æ¨¡å—(ex: sys)
</code></pre>

<h3 id="4-python-reload">4. python reload å‡½æ•°</h3>

<pre><code>reload æ˜¯pythonå†…ç½®å‡½æ•°ï¼Œç”¨äºåœ¨å½“å‰è¿è¡Œæ—¶é‡æ–°åŠ è½½æ¨¡å—ï¼Œä¸ä¼šæ”¹å˜å…ˆå‰æ–‡ä»¶ä¸­çš„æ¨¡å—çŠ¶æ€
</code></pre>

<h3 id="5-reloadsys">5. reload(sys)</h3>

<p>å¦‚æœæˆ‘ä»¬å°è¯•è¿è¡Œ</p>

<pre><code>&gt;&gt; import sys
&gt;&gt; sys.setdefaultencoding('utf-8')
AttributeError: 'module' object has no attribute 'setdefaultencoding'
</code></pre>

<p>å‘ç°å¹¶æ²¡æœ‰<code>setdefaultencoding</code>å‡½æ•°, reloadä»¥åå°±æœ‰äº†, è¿™åˆæ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ<br/><br />
å½“æˆ‘ä»¬å¯¼å…¥åŠ è½½ sys æ¨¡å—æ—¶é¦–å…ˆä¼šåŠ è½½ site.py(/usr/lib/python2.7), çœ‹ä¸€ä¸‹ site.py çš„æºç ï¼š<br />
<img alt="æºç " src="http://7xj431.com1.z0.glb.clouddn.com/å±å¹•å¿«ç…§%202015-09-08%20ä¸‹åˆ11.17.14.png" /><br/></p>

<p>åŸæ¥setdefaultencodingå‡½æ•°è¢«site.pyåˆ æ‰å•¦ï¼è‡³äºä¸ºä»€ä¹ˆè¦åˆ ï¼Œæ³¨é‡Šé‡Œå†™äº†ï¼šä½¿ç”¨æˆ·æ— æ³•åœ¨åˆå§‹åŒ–åæ”¹å˜ç¼–ç <br/><br />
è€Œ reload(sys) åˆ™é‡è½½äº†sysæ¨¡å—, æ²¡æœ‰äº†site.pyçš„è°ƒç”¨ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨<code>setdefaultencoding</code> å‡½æ•°æ”¹å˜ç¼–ç äº†<br/></p>

<h2 id="reloadsys-is-evil">ä½†æ˜¯ä»–ä»¬è¯´: <code>reload(sys) is evil</code></h2>

<p><img alt="2016-12-01 7 53 16" src="https://cloud.githubusercontent.com/assets/10671733/20793036/0771783c-b800-11e6-9c8a-6b3077d53914.png" /> <br/><br />
ä½œä¸ºä¸€ä¸ªä½¿ç”¨äº†<code>reload(sys), sys.setdefaultencoding</code>2å¹´çš„äºº(å› ä¸ºæˆ‘æŠŠå®ƒå†™åˆ°manaé‡Œé¢äº†&hellip;), è¿™å¥è¯ä¸€ç›´è¦ç»•åœ¨æˆ‘çš„è„‘æµ·ä¸­. ä¸ºä»€ä¹ˆevil, æˆ‘ç”¨äº†è¿™ä¹ˆé•¿æ—¶é—´, å¯æ˜¯å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜å•Š? <br/><br />
ç»ˆäºåœ¨ä¸€ä¸ªå¤œæ™š, æˆ‘æƒ³, æˆ‘å¤§æ¦‚æ˜ç™½äº†&hellip;<br/></p>

<h3 id="1">1.å­—ç¬¦ä¸²å’Œå­—èŠ‚ä¸²</h3>

<p>Python2ä¸­æœ‰2ç±»å­—ç¬¦ä¸²ç±»å‹, ä¸€ç±»æ˜¯<code>unicode</code>ä¹Ÿå°±æ˜¯<code>å­—ç¬¦ä¸²</code>, ä¸€ç±»æ˜¯<code>str</code>ä¹Ÿå°±æ˜¯<code>å­—èŠ‚ä¸²</code>.<br/><br />
ç®€å•ç‚¹&hellip; å­—èŠ‚ä¸²æ˜¯å­—ç¬¦ä¸²çš„å®é™…å­˜å‚¨æ–¹å¼, æ¯”å¦‚unicodeæ˜¯ä¸€ä¸ªç¼–ç é›†, utf-8åˆ™æ˜¯unicodeçš„å…·ä½“å®ç°æ–¹å¼, ä¹Ÿå°±æ˜¯è®¡ç®—æœºä¸­äºŒè¿›åˆ¶çš„å­˜å‚¨æ–¹å¼. å…·ä½“å¯ä»¥å‚è€ƒè¿™2ç¯‡æ–‡ç« : <br/></p>

<ul>
<li><a href="http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html">å­—ç¬¦ç¼–ç ç¬”è®°ï¼šASCIIï¼ŒUnicodeå’ŒUTF-8</a></li>
<li><a href="http://www.regexlab.com/zh/encoding.htm">å­—ç¬¦ï¼Œå­—èŠ‚å’Œç¼–ç </a></li>
</ul>

<p><br/></p>

<h3 id="2-python2ascii">2. Python2é»˜è®¤ç¼–ç æ˜¯Ascii</h3>

<p>è¿™ä¸€ç‚¹å¾ˆé‡è¦, Pythonç¬¬ä¸€ä¸ªå…¬å¼€å‘è¡Œç‰ˆæ˜¯1991å¹´, è€Œunicodeæ˜¯1991å¹´æ‰äº§ç”Ÿçš„, æ‰€ä»¥Pythoné‡‡ç”¨äº†å†å²æ‚ ä¹…çš„Asciiä½œä¸ºé»˜è®¤ç¼–ç . <br/><br />
Pythonå°†å­—èŠ‚ä¸²decodeä¸ºå­—ç¬¦ä¸²çš„æ—¶å€™å°±ä¼šä½¿ç”¨asciiç¼–ç , ç„¶è€Œasciiç¼–ç åªèƒ½è¡¨ç¤º256ä¸ªå­—ç¬¦, å¯¹äºæ±‰å­—ç­‰åŒå­—èŠ‚å­—ç¬¦æ— æ³•è¡¨ç¤º, æ‰€ä»¥å°±ä¼šå‡ºç°Pythonä¸­æ–‡å±Šçš„å™©æ¢¦:</p>

<pre><code>UnicodeDecodeError: 'ascii' codec can't decode byte 0xe4 in position 0:
ordinal not in range(128)
</code></pre>

<p>è€Œä½¿ç”¨</p>

<pre><code>import sys
reload(sys)
sys.setdefaultencoding('utf-8')
</code></pre>

<p>å°±ä¼šPythonçš„<code>é»˜è®¤ç¼–ç æ”¹ä¸ºutf-8</code></p>

<h3 id="_3">é‚£è¿™æ ·æœ‰ä»€ä¹ˆä¸å¥½?</h3>

<p>è‹¥æœ‰ä¸å¥½, é‚£ä¹ˆä¸€å®šæ˜¯reloadå‰å, ç°æœ‰çš„ä»£ç è¡Œä¸ºä¼šä¸ä¸€è‡´. <br/><br />
æ¯”å¦‚:</p>

<pre><code>s1 = u"ä¸­æ–‡"
s2 = "ä¸­æ–‡"
s1 == s2
</code></pre>

<p><code>==</code>æ¯”è¾ƒæ“ä½œä¼šæŠŠæ‰€æœ‰çš„å­—èŠ‚ä¸²å…ˆdecodeä¸ºunicodeå­—ç¬¦ä¸², ç„¶åè¿›è¡Œç¼–ç æ¯”è¾ƒ, ç”±äºPythonçš„é»˜è®¤ç¼–ç æ˜¯Ascii, æ‰€ä»¥è¿™é‡Œç”¨ascii decode &ldquo;ä¸­æ–‡&rdquo;çš„æ—¶å€™ä¼šå‡ºé”™:</p>

<pre><code>UnicodeWarning: Unicode equal comparison failed to convert both arguments to
Unicode - interpreting them as being unequal
</code></pre>

<p>è¿™æ˜¯Pythonä¼šå› å‡ºé”™è€Œå°†ç»“æœåˆ¤ä¸ºFalse <br/><br />
ä½†æ˜¯, å½“ä½ reload(sys), é‡ç½®é»˜è®¤ç¼–ç ä¸ºutf-8çš„æ—¶å€™, utf-8 decodeä¸­æ–‡å°±ç»°ç»°æœ‰ä½™äº†,<br />
è¿™æ—¶ç»“æœå°±æ˜¯True! <br/><br />
å­—ç¬¦ä¸²çš„ç­‰äºåˆ¤å®šè¿˜æ˜¯å¾ˆå¸¸è§çš„. reloadå‰åé€ æˆçš„è¡Œä¸ºä¸ä¸€è‡´,<br />
çš„ç¡®ä¼šå½±å“ç»“æœ(Flase-&gt;True)!</p>

<h2 id="reloadsys">æ‰€ä»¥, ä¸ç”¨reload(sys), æˆ‘è¯¥æ€ä¹ˆåš?</h2>

<p>å¯¹äºå­—ç¬¦ä¸²ã€å­—èŠ‚ä¸², ä½¿ç”¨decodeå’Œencodeå°±å¯ä»¥å¾ˆå¥½çš„è§£å†³é—®é¢˜, æ¯”å¦‚</p>

<pre><code>s1 = u"ä¸­æ–‡"  # unicode
s1.encode('utf-8')  # ç¼–ç ä¸ºutf-8
s2 = "hello"  # ascii
s2.decode('ascii')  # è§£ç ä¸ºunicode
</code></pre>

<p>æŠ“å–çš„ç½‘é¡µ, ä¹Ÿå¯ä»¥å€ŸåŠ©ç½‘é¡µmetaä¿¡æ¯, æˆ–è€…requests, bs4, chardetç­‰åˆ¤å®šç¼–ç . <br/><br />
ä½†æ˜¯, æˆ‘ç”¨reload(sys)çš„æœ€åˆåŸå› , æ˜¯æ¥è‡ªflask jinja2æ¨¡ç‰ˆä¸­å‡ºç°ä¸­æ–‡! <br/><br />
æ¯”å¦‚:</p>

<pre><code>@app.route('/')
def index():
    return render_template('index.html', name='ä¹Œä¸¸åƒå²')

&lt;html&gt;&lt;body&gt;{{ name }}&lt;/body&gt;&lt;/html&gt;
</code></pre>

<p>æŠ¥é”™:</p>

<pre><code>File "/Users/apple/holiday/blog/house/Test/app/templates/index.html", line 4, in top-level template code
    &lt;h1&gt;{{ name }}&lt;/h1&gt;
UnicodeDecodeError: 'ascii' codec can't decode byte 0xe6 in position 0: ordinal not in range(128)
</code></pre>

<p>å› ä¸º<code>{{}}</code>é‡Œé¢å®é™…ä¸Šæ˜¯Pythonè§£é‡Šå™¨åœ¨å¤„ç†{å…³äºPythonå‰ç«¯æ¨¡ç‰ˆå¯ä»¥å‚çœ‹mozillazgå¤§ç¥çš„<a href="https://mozillazg.com/2016/03/let-us-build-a-template-engine-part1.html">è®©æˆ‘ä»¬ä¸€èµ·æ¥æ„å»ºä¸€ä¸ªæ¨¡æ¿å¼•æ“</a>}, æ‰€ä»¥ä¹Ÿä¼šé‡åˆ°ä¸­æ–‡ç¼–ç ascii decode errorçš„å‘. è§£å†³åŠæ³•æ˜¯<code>u'ä¹Œä¸¸åƒå²'</code>å°±å¥½äº†&hellip;å› ä¸ºç›´æ¥unicode, ä¸ç”¨asciiè§£ç äº†&hellip; ä»¥å‰ä¸çŸ¥é“, SOPåˆ°<code>sys.setdefaultencoding('utf-8')</code>, å°±ä¸€ç›´ç”¨äº†.<br />
<hr/><br />
ç¼–ç é—®é¢˜æ˜¯Pythonå±Šçš„å¤§å‘, ç°åœ¨çš„Python3åˆä¸ä¸€æ ·äº†&hellip;<br />
æ‰“ç®—è¿‡ä¼šç¿»è¯‘ä¸€ç¯‡<a href="http://lucumr.pocoo.org/2014/1/5/unicode-in-2-and-3/">flaskä½œè€…çš„åæ§½</a>.<br/><br />
å°±é…±&hellip; æ€»ç®—èƒ½è‡ªåœ†å…¶è¯´äº†, æ‰€è°“çš„é€»è¾‘æ­£ç¡®&hellip; å®‰.</p>

<h2 id="_4">å‚è€ƒ</h2>

<ul>
<li><a href="http://lucumr.pocoo.org/2014/1/5/unicode-in-2-and-3/">More About Unicode in Python 2 and 3</a></li>
<li><a href="http://blog.ernest.me/post/python-setdefaultencoding-unicode-bytes">ç«‹å³åœæ­¢ä½¿ç”¨ setdefaultencoding(&lsquo;utf-8&rsquo;),ä»¥åŠä¸ºä»€ä¹ˆ</a></li>
<li><a href="http://www.regexlab.com/zh/encoding.htm">å­—ç¬¦ï¼Œå­—èŠ‚å’Œç¼–ç </a></li>
</ul>

        </div>
    </div>
    <div id="disqus_thread" style="padding: 50px"></div>
    <script>
    /**
    * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    
    s.src = '//neo1218flask.disqus.com/embed.js';
    
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

    </div>
</main>
<footer>
    <div id="foot">
        
            <div class="footer">
                <span>
                    Powered by:
                    <a href="https://github.com/neo1218/railgun/" target="_blank">railgun</a>
                    I am a loser
                </span>
                <br>
            </div>
        
    </div>
</footer>
<div id="back-to-top" data-scroll="body" style="top: -900px;">
</div>
</body>
    <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
    <script src=/static/js/base_site.js></script>
    <script src=/static/js/disqus/embed.js></script>
    <script src=/static/js/menufix.js></script>
    <script src=/static/js/backtotop.js></script>
    <script type="text/javascript">
        function loadMenuFix() { menufix("info_card"); }
        function loadDeadCat() { deadcat("toTop"); }
        function addLoadEvent(func) {
            var oldonload = window.onload;
            if (typeof window.onload != 'function') {
                window.onload = func;
            } else {
                window.onload = function() {
                    if (oldonload) {
                        oldonload();
                    }
                    func();
                }
            }
        }
        addLoadEvent(loadMenuFix);
        // addLoadEvent(loadDeadCat);
    </script>
</html>